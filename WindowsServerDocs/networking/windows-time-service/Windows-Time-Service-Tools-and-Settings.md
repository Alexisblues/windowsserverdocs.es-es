---
ms.assetid: 6086947f-f9ef-4e18-9f07-6c7c81d7002c
title: Configuración y herramientas del servicio Hora de Windows
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 10/16/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 84d10c30d42e92d325475a1143c85acce7456a80
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/27/2019
ms.locfileid: "71395681"
---
# <a name="windows-time-service-tools-and-settings"></a>Configuración y herramientas del servicio Hora de Windows
>Se aplica a: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows 10 o posterior

En este tema, obtendrás información sobre las herramientas y la configuración del servicio Hora de Windows (W32Time). 

Si solo quieres sincronizar la hora de un equipo cliente unido a un dominio, consulta [Configuración de un equipo cliente para la sincronización automática de la hora del dominio](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc816884%28v%3dws.10%29). Para ver otros temas sobre la configuración del servicio Hora de Windows, consulta [Dónde encontrar la información de configuración del servicio Hora de Windows](https://docs.microsoft.com/windows-server/networking/windows-time-service/windows-time-service-top).  

> [!CAUTION]  
> No debes usar el comando Tiempo neto para configurar ni establecer la hora mientras se ejecuta el servicio Hora de Windows.  
>
> Además, en los equipos antiguos que ejecutan Windows XP o versiones anteriores, el comando /querysntp de Tiempo neto muestra el nombre de un servidor de Protocolo de tiempo de redes (NTP) con el que un equipo está configurado para sincronizarse, pero ese servidor NTP solo se usa cuando el cliente de hora del equipo está configurado como NTP o AllSync. Posteriormente, el comando ha quedado en desuso.  

La mayoría de los equipos miembros de dominio tienen un tipo de cliente de hora de NT5DS, lo que significa que sincronizan la hora desde la jerarquía de dominios. La única excepción habitual a esto es el controlador de dominio que funciona como maestro de operaciones del emulador del controlador de dominio principal (PDC) del dominio raíz del bosque, que normalmente se configura para sincronizar la hora con un origen de la hora externo. Para ver la configuración del cliente de hora de un equipo, ejecuta el comando W32tm /query /configuración desde un símbolo del sistema con privilegios elevados a partir de Windows Server 2008 y Windows Vista, y lee la línea **Type** en la salida del comando. Para obtener más información, consulta [Funcionamiento del servicio Hora de Windows](https://docs.microsoft.com/windows-server/networking/windows-time-service/How-the-Windows-Time-Service-Works). Puedes ejecutar el comando **reg query HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters** y leer el valor de **NtpServer** en la salida del comando.  

> [!IMPORTANT]  
> Antes de Windows Server 2016, el servicio W32Time no estaba diseñado para satisfacer las necesidades de las aplicaciones sujetas a limitaciones temporales.  Sin embargo, las actualizaciones de Windows Server 2016 ahora permiten implementar una solución con una precisión de 1 ms en el dominio.  Consulta [Hora precisa para Windows Server 2016](accurate-time.md) y [Límite de soporte para configurar el servicio Hora de Windows para entornos de alta precisión](https://docs.microsoft.com/windows-server/networking/windows-time-service/support-boundary) para obtener más información.  

## <a name="windows-time-service-tools"></a>Herramientas del servicio Hora de Windows  
Las siguientes herramientas están asociadas con el servicio Hora de Windows.  

#### <a name="w32tmexe-windows-time"></a>W32tm.exe: Hora de Windows  
**Categoría**  

Esta herramienta se instala como parte de las instalaciones predeterminadas de Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

**Compatibilidad de versiones**  

Esta herramienta funciona en las instalaciones predeterminadas de Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

W32tm.exe se usa para configurar el servicio Hora de Windows. También se puede usar para diagnosticar problemas con el servicio de hora. W32tm.exe es la herramienta de línea de comandos preferida para configurar, supervisar o solucionar problemas del servicio Hora de Windows.  

En las tablas siguientes se describen los parámetros que se utilizan con W32tm.exe.  

**Parámetros principales de W32tm.exe**  


|                                                                                                                                  Parámetro                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                                                                                   W32tm /?                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Ayuda de la línea de comandos de W32tm.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                                               W32tm /register                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Registra el servicio de hora para que se ejecute como un servicio y agrega la configuración predeterminada al Registro.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                                                                              W32tm /unregister                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Anula el registro del servicio de hora y quita toda la información de configuración del Registro.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                                 w32tm /monitor<br /><br />[/domain:<domain name>] [/computers:<name>[,<name>[,<name>...]]] [/threads:<num>]                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                 domain: especifica el dominio que se va a supervisar. Si no se proporciona ningún nombre de dominio o no se especifican domain ni computers, se usa el dominio predeterminado. Esta opción se puede usar más de una vez.<br /><br />computers: supervisa la lista de equipos especificada. Los nombres de los equipos se separan con comas, no con espacios. Si un nombre tiene el prefijo "\*", se trata como un PDC. Esta opción se puede usar más de una vez.<br /><br />threads: especifica el número de equipos que se van a analizar simultáneamente. El valor predeterminado es 3. El intervalo permitido es de 1-50.                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                         w32tm /ntte <NT time epoch>                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Convierte una hora del sistema NT, en intervalos de (10^-7) s desde las 0 h del 1 de enero de 1601, a un formato legible.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                                                                        w32tm /ntpte <NTP time epoch>                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Convierte una hora NTP, en intervalos de (2^-32) s desde las 0 h del 1 de enero de 1900, a un formato legible.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                               w32tm /resync<br /><br />[/computer:<computer>]<br /><br />[/nowait]<br /><br />[/rediscover]<br /><br />[/soft]                                                                               |                                                                                                                                                                                                                                                                                                                                                                      Indica a un equipo que debe volver a sincronizar el reloj lo antes posible y genera todas las estadísticas de error acumuladas.<br /><br />computer:<computer>: especifica el equipo que debe volver a sincronizarse. Si no se especifica, se volverá a sincronizar el equipo local.<br /><br />nowait: no esperes a que se produzca la resincronización; vuelve inmediatamente. De lo contrario, espera a que la resincronización se complete antes de volver.<br /><br />rediscover: vuelve a detectar la configuración de red y los orígenes de red; a continuación, vuelve realizar la sincronización.<br /><br />soft: vuelve a realizar la sincronización con las estadísticas de error existentes. No es útil, se proporciona con fines de compatibilidad.                                                                                                                                                                                                                                                                                                                                                                      |
|                                                          w32tm /stripchart<br /><br />/computer:<target><br /><br />[/period:<refresh>]<br /><br />[/dataonly]<br /><br />[/samples:<count>]<br/><br/>[/rdtsc]<br/>                                                          |                            Muestra un gráfico de tiras del desplazamiento entre este equipo y otro.<br /><br />computer:<target>: equipo donde se medirá el desplazamiento.<br /><br />period:<refresh>: tiempo transcurrido entre muestras, en segundos. El valor predeterminado es 2 s.<br /><br />dataonly: muestra los datos solamente, sin gráficos.<br /><br />samples:<count>: recopila <count> muestras y luego detente. Si no se especifica, las muestras se recopilarán hasta que se presione **Ctrl + C**.<br/><br/>rdtsc: para cada muestra, esta opción imprime valores separados por comas, junto con los encabezados RdtscStart, RdtscEnd, FileTime, RoundtripDelay y NtpOffset, en lugar del gráfico de texto.<br/><ul><li>[RdtscStart: valor de RDTSC (Read TimeStamp Counter, Contador de marca de tiempo de lectura)](https://en.wikipedia.org/wiki/Time_Stamp_Counter) recopilado justo antes de generar la solicitud NTP.</li><li>RdtscEnd: valor de RDTSC (Read TimeStamp Counter, Contador de marca de tiempo de lectura) recopilado justo después de la recepción y el procesamiento de la solicitud NTP.</li><li>FileTime: valor de FILETIME local usado en la solicitud NTP.</li><li>RoundtripDelay: tiempo transcurrido en segundos entre la generación de la solicitud NTP y el procesamiento de la respuesta NTP recibida, obtenido de los cálculos de ciclos de ida y vuelta de NTP.</li><li>NTPOffset: desfase de hora en segundos entre la máquina local y el servidor NTP, obtenido de los cálculos de desfase NTP.</li></ul>                             |
| w32tm /config<br /><br />[/computer:<target>]<br /><br />[/update]<br /><br />[/manualpeerlist:<peers>]<br /><br />[/syncfromflags:<source>]<br /><br />[/LocalClockDispersion:<seconds>]<br /><br />[/reliable:(YES&#124;NO)]<br /><br />[/largephaseoffset:<milliseconds>] | computer:<target>: ajusta la configuración de <target>. Si no se especifica, el valor predeterminado es el equipo local.<br /><br />update: notifica al servicio de hora que la configuración ha cambiado y hace que los cambios surtan efecto.<br /><br />manualpeerlist:<peers>: establece la lista manual del mismo nivel en <peers>, que es una lista delimitada por espacios de direcciones IP o DNS. Al especificar varios elementos del mismo nivel, esta opción debe ir entre comillas.<br /><br />syncfromflags:<source>: establece los orígenes desde los cuales debe sincronizarse el cliente NTP. <source> debe ser una lista separada por comas de estas palabras clave (no distingue mayúsculas de minúsculas):<br /><br />MANUAL: incluye elementos del mismo nivel de la lista manual del mismo nivel.<br /><br />DOMHIER: realiza la sincronización desde un controlador de dominio (DC) en la jerarquía de dominios.<br /><br />LocalClockDispersion:<seconds>: configura la precisión del reloj interno que supondrá W32Time cuando no pueda adquirir la hora de sus orígenes configurados.<br /><br />reliable:(YES&#124;NO): establece si este equipo es un origen de hora confiable.<br /><br />Esta configuración solo tiene sentido en controladores de dominio.<br /><br />YES: este equipo es un servicio de hora confiable.<br /><br />NO: este equipo no es un servicio de hora confiable.<br /><br />largephaseoffset:<milliseconds>: establece la diferencia horaria entre la hora local y la de la red, que W32Time considerará un pico. |
|                                                                                                                                  w32tm /tz                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Muestra la configuración de zona horaria actual.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  W32tm/dumpreg<br /><br />[/subkey:<key>]<br /><br />[/computer:<target>]                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Muestra los valores asociados a una clave del Registro determinada.<br /><br />La clave predeterminada es HKLM\System\CurrentControlSet\Services\W32Time<br /><br />(clave raíz del servicio de hora).<br /><br />subkey:<key>: muestra los valores asociados a la subclave <key> de la clave predeterminada.<br /><br />computer:<target>: consulta la configuración del Registro para el equipo <target>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                  w32tm /query [/computer:<target>] {/source &#124; /configuration &#124; /peers &#124; /status} [/verbose]                                                                                   |                                                                                                                                                                                                                                                                                                                  Este parámetro primero estaba disponible en las versiones de cliente de Hora de Windows de Windows Vista y Windows Server 2008.<br /><br />Muestra la información del servicio Hora de Windows de un equipo.<br /><br />**computer:<target>** : consulta la información de **<target>** . Si no se especifica, el valor predeterminado es el equipo local.<br /><br />**Source**: muestra el origen de la hora.<br /><br />**Configuration**: muestra la configuración del tiempo de ejecución y la procedencia de la configuración. En el modo detallado, se muestra también el valor sin definir o sin usar.<br /><br />**peers**: muestra una lista de elementos del mismo nivel y su estado.<br /><br />**status**: muestra el estado del servicio Hora de Windows.<br /><br />**verbose**: establece el modo detallado para mostrar más información.                                                                                                                                                                                                                                                                                                                   |
|                                                                                       w32tm /debug {/disable &#124; {/enable /file:<name> /size:<bytes> /entries:<value> [/truncate]}}                                                                                       |                                                                                                                                                                                                                                                                         Este parámetro primero estaba disponible en las versiones de cliente de Hora de Windows de Windows Vista y Windows Server 2008.<br /><br />Habilita o deshabilita el registro privado del servicio Hora de Windows del equipo local.<br /><br />**disable**: deshabilita el registro privado.<br /><br />**enable**: habilita el registro privado.<br /><br />-   **file:<name>** : especifica el nombre de archivo absoluto.<br />-   **size:<bytes>** : especifica el tamaño máximo del registro circular.<br />-   **entries:<value>** : contiene una lista de marcas, especificadas por número y separadas por comas, que indican los tipos de información que se deben registrar. Los números válidos son de 0 a 300. Se admiten tanto un intervalo de números como números individuales (por ejemplo, 0-100,103,106). El valor 0-300 es para registrar toda la información.<br /><br />**truncate**: trunca el archivo si existe.                                                                                                                                                                                                                                                                          |

---  
Para obtener más información sobre **W32tm.exe**, consulta el Centro de ayuda y soporte técnico de Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

## <a name="windows-time-service-registry-entries"></a>Entradas del Registro del servicio Hora de Windows
Las siguientes entradas del Registro están asociadas al servicio Hora de Windows.  

Esta información se proporciona como una referencia para la resolución de problemas o para comprobar que se aplica la configuración necesaria. Te recomendamos que no modifiques directamente el Registro a menos que no haya ninguna otra alternativa. Ni el editor del Registro ni Windows validan las modificaciones del Registro antes de que se apliquen. Como resultado, se pueden almacenar valores incorrectos. Esto puede dar lugar a errores irrecuperables en el sistema.  

Cuando sea posible, en lugar de modificar el Registro directamente, usa la directiva de grupo u otras herramientas de Windows, como Microsoft Management Console (MMC) para realizar las tareas. Si tienes que modificar el registro, ten mucha precaución.  

> [!WARNING]  
> Algunos de los valores preestablecidos configurados en el archivo de Plantillas administrativas (System.adm) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tienes previsto usar un GPO para configurar cualquier opción de Hora de Windows, asegúrate de revisar [Valores preestablecidos para la configuración de directiva de grupo del servicio de hora de Windows son diferentes de las correspondientes entradas del registro servicio hora de Windows en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este tema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003.  

Muchas entradas del Registro para el servicio Hora de Windows son las mismas que para la directiva de grupo del mismo nombre. La configuración de directiva de grupo se corresponde con las entradas del Registro del mismo nombre que se encuentran en:  

>**HKLM\SYSTEM\CurrentControlSet\Services\W32Time\\**


Existen varias claves del Registro en esta ubicación del Registro. La configuración de Hora de Windows se almacena en valores en todas estas claves:

* [Parameters](#hklmsystemcurrentcontrolsetservicesw32timeparameters)
* [Config](#hklmsystemcurrentcontrolsetservicesw32timeconfig)
* [NtpClient](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient)
* [NtpServer](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver)

W32Time usa internamente muchos de los valores de la sección W32Time del Registro para almacenar información. Estos valores no se deben cambiar manualmente en ningún momento. No modifiques ninguna de las opciones de configuración de esta sección a menos que estés familiarizado con la configuración y estés seguro de que el nuevo valor funcionará según lo previsto. Las siguientes entradas del Registro se encuentran en:

**HKLM\SYSTEM\CurrentControlSet\Services\W32Time**  

Cuando se crea una directiva, los valores se configuran en la siguiente ubicación, que no tiene prioridad sobre la siguiente:

**HKLM\SOFTWARE\Policies\Microsoft\Windows\W32time**

La clave de W32time se crea con la directiva.  Cuando se quita la directiva, también se quita esta clave.

La otra ubicación predeterminada es:

**HKLM\SYSTEM\CurrentControlSet\Services\W32time**

Algunos de los parámetros se almacenan en tics de reloj en el Registro y otros en segundos. Para convertir la hora de tics de reloj a segundos:  

-   1 minuto = 60 s  

-   1 s = 1000 ms  

-   1 ms = 10 000 tics del reloj en un sistema Windows, tal como se describe en [Propiedad DateTime.Ticks](https://docs.microsoft.com/dotnet/api/system.datetime.ticks?redirectedfrom=MSDN&view=netframework-4.7.2#System_DateTime_Ticks).  

Por ejemplo, 5 minutos se convertirían en 5\*60\*1000\*10 000 = 3 000 000 000. 

Todas las versiones incluyen Windows 7, Windows 8, Windows 10, Windows Server 2008, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012R2, Windows Server 2016.  Algunas entradas solo están disponibles en las versiones más recientes de Windows.

#### <a name="hklmsystemcurrentcontrolsetservicesw32timeparameters"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters

|          Entrada del Registro          | Version |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AllowNonstandardModeCombinations |   Todos   |                                                                                                                                                                                                                                                                                                                                                                                                              La entrada indica que se permiten combinaciones de modos no estándar en la sincronización entre elementos del mismo nivel. El valor predeterminado para los miembros del dominio es 1. El valor predeterminado para los servidores y clientes independientes es 1.                                                                                                                                                                                                                                                                                                                                                                                                              |
|            NtpServer             |   Todos   | La entrada especifica una lista delimitada por espacios de los elementos del mismo nivel de los que un equipo obtiene las marcas de tiempo, que consta de uno o varios nombres DNS o direcciones IP por línea. Cada nombre DNS o dirección IP de la lista debe ser único. Los equipos conectados a un dominio deben sincronizarse con un origen de hora más confiable, como el reloj oficial de la hora de los EE. UU.  <ul><li>0x01 SpecialInterval </li><li>0x02 UseAsFallbackOnly</li><li>0x04 SymmetricActive: para obtener más información sobre este modo, consulta el artículo sobre los [modos de funcionamiento del servidor de Hora de Windows](https://go.microsoft.com/fwlink/?LinkId=208012) (en inglés).</li><li>0x08 Client</li></ul><br />No hay ningún valor predeterminado para esta entrada del Registro en los miembros del dominio. El valor predeterminado en los servidores y clientes independientes es time.windows.com,0x1.<br /><br />Nota: Para obtener más información sobre los servidores NTP disponibles, consulta el [artículo de Microsoft Knowledge Base 262680: Una lista de los servidores horarios que utilizan el Protocolo simple de tiempo de redes (SNTP) y que están disponibles en Internet](https://support.microsoft.com/help/262680/a-list-of-the-simple-network-time-protocol-sntp-time-servers-that-are). |
|            ServiceDll            |   Todos   |                                                                                                                                                                                                                                                                                                                                                              W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los servidores y clientes independientes es %windir%\System32\W32Time.dll.                                                                                                                                                                                                                                                                                                                                                               |
|           ServiceMain            |   Todos   |                                                                                                                                                                                                                                                                                                                                                       W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado en los miembros del dominio es SvchostEntry_W32Time. El valor predeterminado en los servidores y clientes independientes es SvchostEntry_W32Time.  "                                                                                                                                                                                                                                                                                                                                                       |
|               Tipo               |   Todos   |                                                                                                                                                                                                                                  La entrada indica desde qué elementos del mismo nivel se aceptará la sincronización:  <ul><li>**NoSync**. El servicio de hora no se sincroniza con otros orígenes.</li><li>**NTP.** El servicio de hora se sincroniza desde los servidores especificados en la entrada del Registro **NtpServer**  </li><li>**NT5DS**. El servicio de hora se sincroniza desde la jerarquía de dominios.  </li><li>**AllSync**. El servicio de hora usa todos los mecanismos de sincronización disponibles.  </li></ul>El valor predeterminado en los miembros del dominio es **NT5DS**. El valor predeterminado en los servidores y clientes independientes es **NTP**.                                                                                                                                                                                                                                   |

---
#### <a name="hklmsystemcurrentcontrolsetservicesw32timeconfig"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config

|    Entrada del Registro     |          Version           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     AnnounceFlags     |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              La entrada controla si este equipo está marcado como un servidor de hora confiable. Un equipo no está marcado como confiable a menos que también esté marcado como servidor horario.<br /> -   0x00 no es un servidor horario  <br /> -   0x01 siempre es el servidor horario  <br /> -   0x02 servidor horario automático  <br /> -   0x04 Siempre es un servidor horario confiable  <br /> -   0x08 Servidor horario confiable automático  <br />El valor predeterminado para los miembros del dominio es 10. El valor predeterminado para los servidores y clientes independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|     EventLogFlags     |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          La entrada controla los eventos que registra el servicio de hora.  <br />-   Salto de hora: 0x1  <br />-   Cambio de origen: 0x2  <br />El valor predeterminado en los miembros del dominio es 2. El valor predeterminado en los servidores y clientes independientes es 2.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| FrequencyCorrectRate  |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    La entrada controla la velocidad a la que se corrige el reloj. Si este valor es demasiado pequeño, el reloj es inestable y se sobrecorrige. Si el valor es demasiado grande, el reloj tarda mucho tiempo en sincronizarse. El valor predeterminado en los miembros del dominio es 4. El valor predeterminado en los servidores y clientes independientes es 4.  <br /><br />Ten en cuenta que 0 es un valor no válido para la entrada del Registro FrequencyCorrectRate. En equipos con Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio Hora de Windows lo cambiará automáticamente a 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|      HoldPeriod       |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   La entrada controla el período de tiempo durante el que se deshabilita la detección de picos para que el reloj local se sincronice rápidamente. Un pico es una muestra de tiempo que indica que el tiempo está fuera de un número de segundos y se recibe normalmente después de la devolución constante de muestras de tiempo correctas. El valor predeterminado en los miembros del dominio es 5. El valor predeterminado en los servidores y clientes independientes es 5.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   LargePhaseOffset    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        La entrada especifica que un desfase de hora mayor o igual que este valor en 10<sup>-7</sup> segundos se considera un pico. Una interrupción de la red, como una gran cantidad de tráfico, puede provocar un pico. Un pido se omitirá a menos que se mantenga durante un largo período de tiempo. El valor predeterminado en los miembros del dominio es 50 000 000. El valor predeterminado en los servidores y clientes independientes es 50 000 000.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     LastClockRate     |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado en los miembros del dominio es 156 250. El valor predeterminado en los servidores y clientes independientes es 156 250.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| LocalClockDispersion  |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        La entrada controla la dispersión (en segundos) que debes asumir cuando el único origen de hora es el reloj CMOS integrado. El valor predeterminado en los miembros del dominio es 10. El valor predeterminado en los servidores y clientes independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| MaxAllowedPhaseOffset |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        La entrada especifica el desfase máximo (en segundos) que W32Time intenta ajustar el reloj del equipo con la velocidad del reloj. Si el desfase supera esta velocidad, W32Time establece el reloj del equipo directamente. El valor predeterminado para los miembros del dominio es 300. El valor predeterminado para los servidores y clientes independientes es 1.  [Consulta el apartado siguiente para obtener más información](#maxallowedphaseoffset-information).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     MaxClockRate      |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado para los miembros del dominio es 155 860. El valor predeterminado para los servidores y clientes independientes es 155 860.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| MaxNegPhaseCorrection |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              La entrada especifica la corrección de tiempo negativa más grande en segundos que realiza el servicio. Si el servicio determina que se necesita un cambio mayor que este, registra un evento en su lugar. Caso especial: 0xFFFFFFFF significa que la corrección de hora se realiza siempre. El valor predeterminado para los miembros del dominio es 0xFFFFFFFF. El valor predeterminado de los servidores y clientes independientes es 54 000 (15 horas).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|    MaxPollInterval    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     La entrada especifica el intervalo más grande, en log2 segundos, permitidos para el intervalo de sondeo del sistema. Ten en cuenta que mientras que un sistema debe realizar un sondeo según el intervalo programado, un proveedor puede rechazar la generación de muestras si se le solicita. El valor predeterminado para los controladores de dominio es 10. El valor predeterminado para los miembros del dominio es 15. El valor predeterminado para los servidores y clientes independientes es 15.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| MaxPosPhaseCorrection |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              La entrada especifica la corrección de tiempo positiva más grande en segundos que realiza el servicio. Si el servicio determina que se necesita un cambio mayor que este, registra un evento en su lugar. Caso especial: 0xFFFFFFFF significa que la corrección de hora se realiza siempre. El valor predeterminado para los miembros del dominio es 0xFFFFFFFF. El valor predeterminado de los servidores y clientes independientes es 54 000 (15 horas).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|     MinClockRate      |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado para los miembros del dominio es 155 860. El valor predeterminado para los servidores y clientes independientes es 155 860.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|    MinPollInterval    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              La entrada especifica el intervalo más pequeño, en log2 segundos, permitidos para el intervalo de sondeo del sistema. Ten en cuenta que mientras que un sistema no solicita muestras con más frecuencia que la indicada, un proveedor puede generar muestras en momentos distintos del intervalo programado. El valor predeterminado para los controladores de dominio es 6. El valor predeterminado para los miembros del dominio es 10. El valor predeterminado para los servidores y clientes independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   PhaseCorrectRate    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           La entrada controla la velocidad a la que se corrige el error de fase. Si se especifica un valor pequeño, se corrige el error de fase rápidamente, pero es posible que el reloj se vuelva inestable. Si el valor es demasiado grande, se tarda más tiempo en corregir el error de fase. <br /><br />El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los servidores y clientes independientes es 7.<br /><br />Nota: 0 es un valor no válido para la entrada del Registro PhaseCorrectRate. En equipos con Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio Hora de Windows lo cambia automáticamente a 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   PollAdjustFactor    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       La entrada controla la decisión de aumentar o disminuir el intervalo de sondeo del sistema. Cuanto mayor sea el valor, menor será la cantidad de error que causará una reducción del intervalo de sondeo. El valor predeterminado en los miembros del dominio es 5. El valor predeterminado en los servidores y clientes independientes es 5.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|   SpikeWatchPeriod    |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    La entrada especifica la cantidad de tiempo que un desfase sospechoso debe persistir antes de que se acepte como correcto (en segundos). El valor predeterminado en los miembros del dominio es 900. El valor predeterminado en los servidores y clientes independientes es 900.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|  TimeJumpAuditOffset  |            Todos             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Entero sin signo que indica el umbral de auditoría de salto de hora, en segundos. Si el servicio de hora ajusta el reloj local mediante el ajuste directo del reloj, y la corrección de tiempo es mayor que este valor, el servicio de hora registra un evento de auditoría.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|    UpdateInterval     |            Todos             | La entrada especifica el número de tics del reloj entre los ajustes de corrección de fase. El valor predeterminado para los controladores de dominio es 100. El valor predeterminado para los miembros del dominio es 30 000. El valor predeterminado para los servidores y clientes independientes es 360 000.  <br /><br />**NOTA**: Cero es un valor no válido para la entrada del Registro UpdateInterval. En equipos que ejecutan Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio Hora de Windows lo cambia automáticamente a 1.<br /><br />Las siguientes tres entradas del Registro no forman parte de la configuración predeterminada de W32Time, pero se pueden agregar al Registro para obtener una mayor capacidad de registro. La información registrada en el registro de eventos del sistema se puede modificar cambiando el valor de la opción EventLogFlags en el Editor de objetos de directiva de grupo. De forma predeterminada, el servicio de hora crea un registro en el Visor de eventos cada vez que cambia a un nuevo origen de hora.<br /><br />**ADVERTENCIA**: Algunos de los valores preestablecidos configurados en el archivo de Plantillas administrativas (System.adm) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tienes previsto usar un GPO para configurar cualquier opción de Hora de Windows, asegúrate de revisar [Valores preestablecidos para la configuración de directiva de grupo del servicio de hora de Windows son diferentes de las correspondientes entradas del registro servicio hora de Windows en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este tema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003. |
|  UtilizeSslTimeData   | Posterior a la compilación 1511 de Windows 10 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             La entrada 1 indica que W32Time usará varias marcas de tiempo de SSL para inicializar un reloj que es extremadamente impreciso.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

---
Se deben agregar las siguientes entradas de Registro para habilitar el registro de W32Time:  

|Entrada del Registro|Version|Descripción|
|------------------------------------|---------------|----------------------------|
|FileLogEntries|Todos|La entrada controla la cantidad de entradas creadas en el archivo de registro de Hora de Windows. El valor predeterminado es none, que no registra ninguna actividad de Hora de Windows. Los valores válidos son de 0 a 300. Este valor no afecta a las entradas del registro de eventos que crea normalmente Hora de Windows.|
|FileLogName|Todos|La entrada controla la ubicación y el nombre de archivo del registro de Hora de Windows. El valor predeterminado está en blanco y no debe cambiarse a menos que se modifique **FileLogEntries**. Un valor válido es una ruta de acceso completa y un nombre de archivo que Hora de Windows usará para crear el archivo de registro. Este valor no afecta a las entradas del registro de eventos que crea normalmente Hora de Windows.  |
|FileLogSize|Todos|La entrada controla el comportamiento del registro circular de los archivos de registro de Hora de Windows. Cuando se definen **FileLogEntries** y **FileLogName**, Entry define el tamaño, en bytes, para permitir la cobertura del archivo de registro antes de sobrescribir las entradas de registro más antiguas con nuevas entradas. Use un valor igual o mayor que 1 000 000 para esta configuración. Este valor no afecta a las entradas del registro de eventos que crea normalmente Hora de Windows.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient

|Entrada del Registro|Version|Descripción|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Todos|La entrada indica que se permiten combinaciones de modos no estándar en la sincronización entre elementos del mismo nivel. El valor predeterminado para los miembros del dominio es 1. El valor predeterminado para los servidores y clientes independientes es 1.|
|CompatibilityFlags|Todos|La entrada especifica los valores y las marcas de compatibilidad siguientes: <br /><br />-   DispersionInvalid: 0x00000001  <br />-   IgnoreFutureRefTimeStamp: 0x00000002  <br /> -   AutodetectWin2K: 0x80000000  <br />-   AutodetectWin2KStage2: 0x40000000  <br /><br />El valor predeterminado para los miembros del dominio es 0x80000000. El valor predeterminado para los servidores y clientes independientes es 0x80000000.  |
|CrossSiteSyncFlags|Todos|La entrada determina si el servicio elige asociados de sincronización fuera del dominio del equipo. Las opciones y los valores son:  <br /><br />-   None: 0  <br />-   PdcOnly: 1  <br />-   All: 2  <br /><br />Este valor se omite si no se establece el valor de NT5DS. El valor predeterminado para los miembros del dominio es 2. El valor predeterminado para los servidores y clientes independientes es 2.  |
|DllName|Todos|La entrada especifica la ubicación del archivo DLL para el proveedor de hora.  <br /><br />La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los servidores y clientes independientes es %windir%\System32\W32Time.dll.|
|Habilitada|Todos|La entrada indica si el proveedor NtpClient está habilitado en el servicio de hora actual.  <br /><ul><li>Sí 1</li><li>No 0</li></ul>El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los servidores y clientes independientes es 1.|
|EventLogFlags|Todos|La entrada especifica los eventos registrados por el servicio Hora de Windows.<ul><li>0x1 la disponibilidad cambia</li><li>0X2 sesgo de muestra grande (solo es aplicable a Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2)</li></ul>El valor predeterminado en los miembros del dominio es 0x1. El valor predeterminado en los servidores y clientes independientes es 0x1.|
|InputProvider|Todos|La entrada indica si se debe habilitar NtpClient como InputProvider, que obtiene la información de hora de NtpServer. NtpServer es un servidor de hora que responde a las solicitudes de hora del cliente en la red, para lo cual devuelve muestras de hora que son útiles para sincronizar el reloj local. <ul><li>Sí = 1  </li><li>No = 0 </li></ul><p>Valor predeterminado para los miembros del dominio y los clientes independientes: 1  |
|LargeSampleSkew|Todos|La entrada especifica el sesgo de muestras grande del registro en segundos. Para cumplir con las especificaciones de la Comisión de Valores y Bolsa de EE. UU. (SEC), debe establecerse en tres segundos. Los eventos se registrarán para esta opción solo cuando EventLogFlags se configure explícitamente para el sesgo de muestra grande de 0x2. El valor predeterminado en los miembros del dominio es 3. El valor predeterminado en los servidores y clientes independientes es 3.  |
|ResolvePeerBackOffMaxTimes|Todos|La entrada especifica el número máximo de veces que se debe duplicar el intervalo de espera cuando se intenta buscar repetidamente un elemento del mismo nivel para la sincronización sin éxito. Un valor de cero significa que el intervalo de espera siempre es el mínimo. El valor predeterminado en los miembros del dominio es 7. El valor predeterminado en los servidores y clientes independientes es 7. |
|ResolvePeerBackoffMinutes|Todos|La entrada especifica el intervalo inicial que hay que esperar, en minutos, antes de intentar buscar un elemento del mismo nivel para la sincronización. El valor predeterminado en los miembros del dominio es 15. El valor predeterminado en los servidores y clientes independientes es 15.  |
|SpecialPollInterval|Todos|La entrada especifica el intervalo de sondeo especial en segundos para los elementos del mismo nivel manuales. Cuando se habilita la marca SpecialInterval 0x1, W32Time usa este intervalo de sondeo en lugar de un intervalo de sondeo determinado por el sistema operativo. El valor predeterminado en los miembros del dominio es 3600. El valor predeterminado en los servidores y clientes independientes es 604 800.<br/><br/>Nuevo para la compilación 1702, SpecialPollInterval se incluye en los valores del Registro MinPollInterval y MaxPollInterval Config.|
|SpecialPollTimeRemaining|Todos|W32Time mantiene la entrada. Contiene datos reservados que se usan en el sistema operativo Windows. Especifica el tiempo en segundos antes de que W32Time se vuelva a sincronizar después de reiniciar el equipo. Cualquier cambio en esta opción puede provocar resultados imprevisibles. El valor predeterminado en ambos miembros del dominio y en los servidores y clientes independientes se deja en blanco.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpServer

|Entrada del Registro|Version|Descripción|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Todos|La entrada indica que se permiten combinaciones de modos no estándar en la sincronización entre clientes y servidores. El valor predeterminado para los miembros del dominio es 1. El valor predeterminado para los servidores y clientes independientes es 1.|
|DllName|Todos|La entrada especifica la ubicación del archivo DLL para el proveedor de hora.<br /><br />La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los servidores y clientes independientes es %windir%\System32\W32Time.dll.  |
|Habilitada|Todos|La entrada indica si el proveedor NtpServer está habilitado en el servicio de hora actual. <ul><li>Sí 1</li><li>No 0</li></ul>El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los servidores y clientes independientes es 1.  |
|InputProvider|Todos|La entrada indica si se debe habilitar NtpClient como InputProvider, que obtiene la información de hora de NtpServer. NtpServer es un servidor de hora que responde a las solicitudes de hora del cliente en la red, para lo cual devuelve muestras de hora que son útiles para sincronizar el reloj local. <ul><li>Sí = 1  </li><li>No = 0 </li></ul><p>Valor predeterminado para los miembros del dominio y los clientes independientes: 1  |

---

#### <a name="maxallowedphaseoffset-information"></a>Información de MaxAllowedPhaseOffset
Para que W32Time establezca el reloj del equipo gradualmente, el desfase debe ser menor que el valor de **MaxAllowedPhaseOffset** y satisfacer la siguiente ecuación al mismo tiempo:  

* Windows Server 2016 y versiones posteriores:
   ```  
    |CurrentTimeOffset| / (16*PhaseCorrectRate*pollIntervalInSeconds) <= SystemClockRate / 2  
   ``` 
* Windows Server 2012 R2 y versiones anteriores:
   ```  
   |CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2  
   ``` 
El valor de **CurrentTimeOffset** se mide en tics del reloj, donde 1 ms = 10 000 tics del reloj en un sistema Windows.  

**SystemClockRate** y **PhaseCorrectRate** también se miden en tics del reloj. Para obtener el valor **SystemClockRate**, puedes usar el siguiente comando y convertirlo de segundos a tics del reloj mediante la fórmula de segundos*1000\*10000:  

```  
W32tm /query /status /verbose  
ClockRate: 0.0156000s  
```  

**SystemclockRate** es la velocidad del reloj en el sistema. Si tomamos como ejemplo 156 000 segundos, el valor **SystemclockRate** sería = 0,0156000 \* 1000 \* 10 000 = 156 000 tics del reloj.  

**MaxAllowedPhaseOffset** también se expresa en segundos. Para convertirlo en tics del reloj, multiplica **MaxAllowedPhaseOffset**\*1000\*10 000.  

En los siguientes ejemplos se muestra cómo aplicar estos cálculos cuando se usa Windows Server 2012 R2 o una versión anterior.

**Ejemplo 1**: La hora difiere en 4 minutos (por ejemplo, tu hora es 11:05 y la hora de muestra que has recibido de un elemento del mismo nivel y que se considera correcta es 11:09).
  
```
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

|currentTimeOffset| = 4mins = 4*60\*1000\*10000 = 2400000000 ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

2400000000 <= 6000000000 = TRUE  
```

¿Cumple con la ecuación anterior? 

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 2,400,000,000 / (30000*1) <= 156000/2  

Is 80,000 <= 78,000  

NO/FALSE  
```  

Por lo tanto, W32tm retrasaría el reloj inmediatamente.  

> [!NOTE]  
> En este caso, si quieres retrasar el reloj lentamente, también tendrás que ajustar los valores de **PhaseCorrectRate** o **updateInterval** en el Registro para asegurarte de que el resultado de la ecuación sea **TRUE**.  

**Ejemplo 2**: La hora difiere en 3 minutos. 
 
```  
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

currentTimeOffset = 3mins = 3*60\*1000\*10000 = 1800000000 clock ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

1800000000 <= 6000000000 = TRUE  
```  

¿Cumple con la ecuación anterior?

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 3 mins (1,800,000,000) / (30000*1) <= 156000/2  

Is 60,000 <= 78,000  

YES/TRUE  
```  

En este caso, el reloj se retrasará lentamente.  

## <a name="windows-time-service-group-policy-settings"></a>Configuración de directiva de grupo de servicio Hora de Windows  
Puedes configurar la mayoría de los parámetros de W32Time mediante el Editor de objetos de directiva de grupo. Incluye la configuración de un equipo para que sea NTPServer o NTPClient, la configuración del mecanismo de sincronización de la hora y la configuración de un equipo para que sea un origen de hora confiable.  

> [!NOTE]  
> La configuración de la directiva de grupo del servicio Hora de Windows se puede configurar en los controladores de dominio de Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2 y solo se puede aplicar a equipos que ejecutan Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

Puedes encontrar la configuración de la directiva de grupo que se usa para configurar W32Time en el complemento Editor de objetos de directiva de grupo en las siguientes ubicaciones:  

-   Configuración del equipo\Plantillas administrativas\Sistema\Servicio Hora de Windows  

    Define los **parámetros de configuración global** aquí.  

-   Configuración del equipo\Plantillas administrativas\Sistema\Servicio Hora de Windows\Proveedores de hora  

    Configura el **cliente NTP de Windows** aquí.  

    Habilita el **cliente NTP de Windows** aquí.  

    Habilita el **servidor NTP de Windows** aquí.  

> [!WARNING]  
> Algunos de los valores preestablecidos configurados en el archivo de Plantillas administrativas (System.adm) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tienes previsto usar un GPO para configurar cualquier opción de Hora de Windows, asegúrate de revisar [Valores preestablecidos para la configuración de directiva de grupo del servicio de hora de Windows son diferentes de las correspondientes entradas del registro servicio hora de Windows en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este tema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003.  

En la tabla siguiente se enumeran las opciones de la directiva de grupo globales asociadas al servicio Hora de Windows y el valor preestablecido asociado a cada opción. Para obtener más información acerca de cada opción, consulta las entradas del Registro correspondientes en [Entradas del Registro del servicio Hora de Windows](#windows-time-service-registry-entries) anteriormente en este tema. Las siguientes opciones de configuración se incluyen en un solo GPO denominado **Parámetros de configuración global**.  

**Configuración de la directiva de grupo global asociada al servicio Hora de Windows**  

|Configuración de directiva de grupo|Valor preestablecido|  
|------------------------|------------------|  
|AnnounceFlags|10|  
|EventLogFlags|2|  
|FrequencyCorrectRate|4|  
|HoldPeriod|5|  
|LargePhaseOffset|1280000|  
|LocalClockDispersion|10|  
|MaxAllowedPhaseOffset|300|  
|MaxNegPhaseCorrection|54 000 (15 horas)|  
|MaxPollInterval|15|  
|MaxPosPhaseCorrection|54 000 (15 horas)|  
|MinPollInterval|10|  
|PhaseCorrectRate|7|  
|PollAdjustFactor|5|  
|SpikeWatchPeriod|90|  
|UpdateInterval|100|  

En la tabla siguiente se enumeran las opciones de configuración disponibles para el GPO **Configurar el cliente NTP de Windows** y los valores predefinidos asociados al servicio Hora de Windows. Para obtener más información acerca de cada opción, consulta las entradas del Registro correspondientes en [Entradas del Registro del servicio Hora de Windows](#windows-time-service-registry-entries) anteriormente en este tema.  

**Configuración de la directiva de grupo del cliente NTP asociada al servicio Hora de Windows**  

|Configuración de directiva de grupo|Valor predeterminado|  
|------------------------|-----------------|  
|NtpServer|time.windows.com,0x1|  
|Tipo|Opciones predeterminadas:<br /><br />-   **NTP.** Úsala en equipos que no estén unidos a un dominio.<br />-   **NT5DS.** Úsala en equipos que estén unidos a un dominio.|  
|CrossSiteSyncFlags|2|  
|ResolvePeerBackoffMinutes|15|  
|ResolvePeerBackoffMaxTimes|7|  
|SpecialPollInterval|3600|  
|EventLogFlags|0|  

## <a name="network-ports-used-by-the-windows-time-service"></a>Puertos de red usados por el servicio Hora de Windows  
Hora de Windows sigue la especificación NTP, que requiere el uso del puerto UDP 123 para todas las comunicaciones de sincronización de hora. Este puerto está reservado por Hora de Windows y permanece reservado en todo momento. Cada vez que el equipo sincroniza el reloj o proporciona la hora a otro equipo, la comunicación se realiza en el puerto UDP 123.  

> [!NOTE]  
> Si tienes un equipo con varios adaptadores de red (también denominado equipo de hosts múltiples), no puedes habilitar de forma selectiva el servicio Hora de Windows basado en el adaptador de red.  

## <a name="related-information"></a>Información relacionada  
Los recursos siguientes contienen información adicional relevante para esta sección.  

-   RFC *1305* en la base de datos RFC de IETF  

