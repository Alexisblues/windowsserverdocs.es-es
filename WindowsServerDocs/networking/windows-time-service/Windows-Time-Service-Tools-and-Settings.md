---
ms.assetid: 6086947f-f9ef-4e18-9f07-6c7c81d7002c
title: Configuración y herramientas del servicio Hora de Windows
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 10/16/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: edbdcba60388ba4f79c6e4000734298206c69840
ms.sourcegitcommit: 0467b8e69de66e3184a42440dd55cccca584ba95
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/16/2019
ms.locfileid: "69546631"
---
# <a name="windows-time-service-tools-and-settings"></a>Configuración y herramientas del servicio Hora de Windows
>Se aplica a: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows 10 o posterior

En este tema, obtendrá información sobre las herramientas y la configuración del servicio de hora de Windows (W32Time). 

Si solo desea sincronizar la hora de un equipo cliente unido a un dominio, consulte [configurar un equipo cliente para la sincronización automática](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc816884%28v%3dws.10%29)de la hora del dominio. Para obtener más información sobre cómo configurar el servicio de hora de Windows, consulte [dónde encontrar la información de configuración del servicio de hora de Windows](https://docs.microsoft.com/windows-server/networking/windows-time-service/windows-time-service-top).  

> [!CAUTION]  
> No debe usar el comando net Time para configurar o establecer la hora a la que se ejecuta el servicio de hora de Windows.  
>
> Además, en los equipos más antiguos que ejecutan Windows XP o versiones anteriores, el comando net Time/querysntp muestra el nombre de un servidor de protocolo de tiempo de red (NTP) con el que un equipo está configurado para sincronizarse, pero ese servidor NTP solo se usa cuando el cliente de hora del equipo es configurado como NTP o AllSync. Ese comando ya no está en desuso.  

La mayoría de los equipos miembros de dominio tienen un tipo de cliente de hora de NT5DS, lo que significa que sincronizan la hora desde la jerarquía de dominios. La única excepción típica es el controlador de dominio que funciona como maestro de operaciones del emulador del controlador de dominio principal (PDC) del dominio raíz del bosque, que normalmente se configura para sincronizar la hora con un origen de hora externo. Para ver la configuración de tiempo de cliente de un equipo, ejecute el comando W32tm/Query/configuración desde un símbolo del sistema con privilegios elevados en a partir de Windows Server 2008 y Windows Vista, y lea la línea de **tipo** en el resultado del comando. Para obtener más información, vea [Cómo funciona el servicio de hora de Windows](https://docs.microsoft.com/windows-server/networking/windows-time-service/How-the-Windows-Time-Service-Works). Puede ejecutar el comando **reg Query HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters** y leer el valor de **NtpServer** en el resultado del comando.  

> [!IMPORTANT]  
> Antes de Windows Server 2016, el servicio W32Time no estaba diseñado para satisfacer las necesidades de la aplicación que depende del tiempo.  Sin embargo, las actualizaciones de Windows Server 2016 permiten ahora implementar una solución de una precisión de 1 ms en el dominio.  Consulte el límite de [tiempo](accurate-time.md) y [soporte técnico de Windows 2016 para configurar el servicio de hora de Windows para entornos de alta precisión](https://docs.microsoft.com/windows-server/networking/windows-time-service/support-boundary) para obtener más información.  

## <a name="windows-time-service-tools"></a>Herramientas del servicio de hora de Windows  
Las siguientes herramientas están asociadas con el servicio de hora de Windows.  

#### <a name="w32tmexe-windows-time"></a>W32tm. exe: Hora de Windows  
**Categoría**  

Esta herramienta se instala como parte de las instalaciones predeterminadas de Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

**Compatibilidad de versiones**  

Esta herramienta funciona en las instalaciones predeterminadas de Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

W32tm. exe se usa para configurar el servicio de hora de Windows. También se puede usar para diagnosticar problemas con el servicio de hora. W32tm. exe es la herramienta de línea de comandos preferida para configurar, supervisar o solucionar problemas del servicio de hora de Windows.  

En las tablas siguientes se describen los parámetros que se utilizan con W32tm. exe.  

**Parámetros principales de W32tm. exe**  


|                                                                                                                                  Parámetro                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                                                                                   W32tm/?                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Ayuda de la línea de comandos W32tm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                                               W32tm/Register                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Registra el servicio de hora para que se ejecute como un servicio y agrega la configuración predeterminada al registro.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                                                                              W32tm/unregister                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Anula el registro del servicio de hora y quita toda la información de configuración del registro.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                                 W32tm/monitor<br /><br />[/Domain:<domain name>] [/equipos:<name>[,<name>[,<name>...]]] [/Threads:<num>]                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                 dominio: especifica el dominio que se va a supervisar. Si no se proporciona ningún nombre de dominio, o si no se especifica la opción dominio ni equipos, se usa el dominio predeterminado. Esta opción se puede usar más de una vez.<br /><br />equipos: supervisa la lista de equipos especificada. Los nombres de equipo se separan mediante comas, sin espacios en blanco. Si un nombre tiene el prefijo "\*", se trata como un PDC. Esta opción se puede usar más de una vez.<br /><br />subprocesos: especifica el número de equipos que se van a analizar simultáneamente. El valor predeterminado es 3. El intervalo permitido es 1-50.                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                         W32tm/ntte<NT time epoch>                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Convierte una hora del sistema NT, en (10 ^-7) intervalos de 0H 1 a enero de 1601, en un formato legible.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                                                                        W32tm/ntpte<NTP time epoch>                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Convierta una hora NTP, en (2 ^-32) intervalos de 0H 1 a enero de 1900, en un formato legible.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                               W32tm/Resync<br /><br />[/Computer:<computer>]<br /><br />/nowait<br /><br />[/rediscover]<br /><br />[/soft]                                                                               |                                                                                                                                                                                                                                                                                                                                                                      Indica a un equipo que debe volver a sincronizar su reloj lo antes posible, de modo que se produzcan todas las estadísticas de errores acumulados.<br /><br />equipo:<computer> especifica el equipo que debe volver a sincronizarse. Si no se especifica, el equipo local se volverá a sincronizar.<br /><br />nowait: no espere a que se produzca la resincronización; volver inmediatamente. De lo contrario, espere a que la resincronización se complete antes de volver.<br /><br />volver a detectar: vuelva a detectar la configuración de red y vuelva a detectar los orígenes de red y, a continuación, vuelva a sincronizar.<br /><br />resincronización parcial con las estadísticas de error existentes. No es útil, proporcionado por compatibilidad.                                                                                                                                                                                                                                                                                                                                                                      |
|                                                          W32tm/Stripchart<br /><br />/Computer<target><br /><br />[/Period:<refresh>]<br /><br />[/dataonly]<br /><br />[/Samples:<count>]<br/><br/>[/rdtsc]<br/>                                                          |                            Muestra un gráfico de franjas con el desplazamiento entre este equipo y otro equipo.<br /><br />equipo:<target> -el equipo en el que se va a medir el desplazamiento.<br /><br />período:<refresh> el tiempo transcurrido entre muestras, en segundos. El valor predeterminado es 2.<br /><br />solo datos: muestra solo los datos sin gráficos.<br /><br />ejemplos:<count> -Collect <count> samples y STOP. Si no se especifica, los ejemplos se recopilarán hasta que se presione **Ctrl + C** .<br/><br/>RDTSC: para cada ejemplo, esta opción imprime valores separados por comas junto con los encabezados RdtscStart, RdtscEnd, FileTime, RoundtripDelay, NtpOffset en lugar del gráfico de texto.<br/><ul><li>[RdtscStart – valor de RDTSC (leer contador de marca](https://en.wikipedia.org/wiki/Time_Stamp_Counter) de tiempo) recopilado justo antes de que se generara la solicitud NTP.</li><li>RdtscEnd – valor de RDTSC (leer contador de marca de tiempo) recopilado justo después de que se haya recibido y procesado la respuesta NTP.</li><li>FileTime: valor de FILETIME local usado en la solicitud NTP.</li><li>RoundtripDelay: tiempo transcurrido en segundos entre la generación de la solicitud NTP y el procesamiento de la respuesta NTP recibida, calculada según los cálculos de ida y vuelta de NTP.</li><li>NTPOffset: desplazamiento de tiempo en segundos entre el equipo local y el servidor NTP, calculado según los cálculos de desplazamiento por NTP.</li></ul>                             |
| W32tm/config<br /><br />[/Computer:<target>]<br /><br />/Update<br /><br />[/manualpeerlist:<peers>]<br /><br />[/syncfromflags:<source>]<br /><br />[/LocalClockDispersion:<seconds>]<br /><br />[/Reliable: (sí&#124;no)]<br /><br />[/largephaseoffset:<milliseconds>] | equipo:<target> ajusta la configuración de <target>. Si no se especifica, el valor predeterminado es el equipo local.<br /><br />Update: notifica al servicio de hora que la configuración ha cambiado, lo que hace que los cambios surtan efecto.<br /><br />manualpeerlist:<peers> : establece la lista manual del mismo <peers>nivel en, que es una lista delimitada por espacios de direcciones DNS o IP. Al especificar varios elementos del mismo nivel, esta opción debe ir entre comillas.<br /><br />syncfromflags:<source> -establece de qué orígenes debe sincronizar el cliente NTP. <source>debe ser una lista separada por comas de estas palabras clave (no distingue entre mayúsculas y minúsculas):<br /><br />MANUAL: incluir elementos del mismo nivel en la lista manual del mismo nivel.<br /><br />DOMHIER: sincronizar desde un controlador de dominio (DC) en la jerarquía de dominios.<br /><br />LocalClockDispersion:<seconds> configura la precisión del reloj interno que W32Time asumirá cuando no pueda adquirir tiempo de sus orígenes configurados.<br /><br />confiable: (sí&#124;no): establece si este equipo es un origen de hora confiable.<br /><br />Esta configuración solo es significativa en los controladores de dominio.<br /><br />SÍ: este equipo es un servicio de hora confiable.<br /><br />NO: este equipo no es un servicio de hora confiable.<br /><br />largephaseoffset:<milliseconds> establece la diferencia horaria entre la hora local y la de la red, que W32Time considerará un pico. |
|                                                                                                                                  W32tm/TZ                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Mostrar la configuración de zona horaria actual.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  W32tm/dumpreg<br /><br />[/SubKey:<key>]<br /><br />[/Computer:<target>]                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Mostrar los valores asociados a una clave del registro determinada.<br /><br />La clave predeterminada es HKLM\System\CurrentControlSet\Services\W32Time<br /><br />(la clave raíz del servicio de hora).<br /><br />subclave<key> : muestra los valores asociados a la <key> subclave de la clave predeterminada.<br /><br />equipo:<target> -consulta la configuración del registro para el equipo<target>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                  W32tm/Query [/Computer:<target>] {/source &#124; /configuración &#124; /Peers &#124; /status} [/verbose]                                                                                   |                                                                                                                                                                                                                                                                                                                  Este parámetro primero estaba disponible en las versiones de cliente de hora de Windows de Windows Vista y Windows Server 2008.<br /><br />Muestra la información del servicio de hora de Windows de un equipo.<br /><br />**equipo:<target>**  -consultar la información de **<target>** . Si no se especifica, el valor predeterminado es el equipo local.<br /><br />**Origen** : muestra el origen de la hora.<br /><br />**Configuración** : muestra la configuración de tiempo de ejecución y de dónde procede la configuración. En el modo detallado, se muestra también el valor sin definir o sin usar.<br /><br />**elementos del mismo nivel** : muestra una lista de elementos del mismo nivel y su estado.<br /><br />**Estado** : muestra el estado del servicio de hora de Windows.<br /><br />**detallado** : establezca el modo detallado para mostrar más información.                                                                                                                                                                                                                                                                                                                   |
|                                                                                       W32tm/Debug {/Disable &#124; {/enable/File:<name> /Size:<bytes> /entries:<value> [/truncate]}}                                                                                       |                                                                                                                                                                                                                                                                         Este parámetro primero estaba disponible en las versiones de cliente de hora de Windows de Windows Vista y Windows Server 2008.<br /><br />Habilitar o deshabilitar el registro privado del servicio de hora de Windows del equipo local.<br /><br />**deshabilitar** : deshabilita el registro privado.<br /><br />**Habilitar** : habilita el registro privado.<br /><br />-   **archivo:<name>**  especifique el nombre de archivo absoluto.<br />-   **Tamaño:<bytes>**  especifique el tamaño máximo para el registro circular.<br />-   **entradas:<value>**  -contiene una lista de marcas, especificadas por número y separadas por comas, que especifican los tipos de información que se deben registrar. Los números válidos son de 0 a 300. Un intervalo de números es válido, además de números individuales, como 0-100103106. El valor 0-300 es para registrar toda la información.<br /><br />**TRUNCATE** : trunca el archivo si existe.                                                                                                                                                                                                                                                                          |

---  
Para obtener más información sobre **W32tm. exe**, vea centro de ayuda y soporte técnico en Windows XP, Windows Vista, Windows 7, windows Server 2003, windows Server 2003 R2, windows Server 2008 y windows Server 2008 R2.  

## <a name="windows-time-service-registry-entries"></a>Entradas del registro del servicio de hora de Windows
Las siguientes entradas del registro se asocian con el servicio de hora de Windows.  

Esta información se proporciona como una referencia para su uso en la solución de problemas o la comprobación de que se aplica la configuración necesaria. Se recomienda no editar directamente el registro a menos que no haya otra alternativa. El editor del registro o Windows no validan las modificaciones del registro antes de que se apliquen y, como resultado, se pueden almacenar valores incorrectos. Esto puede dar lugar a errores irrecuperables en el sistema.  

Cuando sea posible, use directiva de grupo u otras herramientas de Windows, como Microsoft Management Console (MMC), para realizar tareas en lugar de editar el registro directamente. Si tienes que modificar el registro, ten mucha precaución.  

> [!WARNING]  
> Algunos de los valores preestablecidos que se configuran en el archivo de plantilla administrativa del sistema (System. ADM) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tiene previsto usar un GPO para configurar las opciones de hora de Windows, asegúrese de revisar [los valores preestablecidos para el servicio de hora de windows Directiva de grupo configuración es diferente de las entradas del registro del servicio de hora de Windows correspondientes en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este problema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003.  

Muchas entradas del registro para el servicio de hora de Windows son las mismas que las del directiva de grupo valor del mismo nombre. La configuración de directiva de grupo se corresponde con las entradas del registro del mismo nombre que se encuentran en:  

>**HKLM\SYSTEM\CurrentControlSet\Services\W32Time\\**


Hay varias claves del registro en esta ubicación del registro. La configuración de hora de Windows se almacena en valores en todas estas claves:

* [Los](#hklmsystemcurrentcontrolsetservicesw32timeparameters)
* [Configurar](#hklmsystemcurrentcontrolsetservicesw32timeconfig)
* [Resolvi](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient)
* [NtpServer](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver)

W32Time usa internamente muchos de los valores de la sección W32Time del registro para almacenar información. Estos valores no se deben cambiar manualmente en ningún momento. No modifique ninguna de las opciones de configuración de esta sección a menos que esté familiarizado con la configuración y esté seguro de que el nuevo valor funcionará según lo previsto. Las siguientes entradas del registro se encuentran en:

**HKLM\SYSTEM\CurrentControlSet\Services\W32Time**  

Cuando se crea una directiva, los valores se configuran en la siguiente ubicación, que no tiene prioridad sobre la siguiente ubicación:

**HKLM\SOFTWARE\Policies\Microsoft\Windows\W32time**

La clave W32time se crea con la Directiva.  Cuando se quita la Directiva, también se quita esta clave.

La otra ubicación predeterminada:

**HKLM\SYSTEM\CurrentControlSet\Services\W32time**

Algunos de los parámetros se almacenan en TICs de reloj en el registro y otros en segundos. Para convertir la hora de los ciclos de reloj a segundos:  

-   1 minuto = 60 segundos  

-   1 s = 1000 ms  

-   1 ms = 10.000 TICs del reloj en un sistema Windows, tal como se describe en la [propiedad DateTime. Ticks](https://docs.microsoft.com/dotnet/api/system.datetime.ticks?redirectedfrom=MSDN&view=netframework-4.7.2#System_DateTime_Ticks).  

Por ejemplo, 5 minutos se convertirían\*en\*5\*60 1000 10000 = 3 mil millones TICs de reloj. 

Todas las versiones incluyen Windows 7, Windows 8, Windows 10, Windows Server 2008 y Windows Server 2008 R2, Windows Server 2012, Windows Server 2012R2, Windows Server 2016.  Algunas entradas solo están disponibles en las versiones más recientes de Windows.

#### <a name="hklmsystemcurrentcontrolsetservicesw32timeparameters"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters

|          Entrada del registro          | `Version` |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AllowNonstandardModeCombinations |   Todo   |                                                                                                                                                                                                                                                                                                                                                                                                              La entrada indica que se permiten combinaciones de modo no estándar en la sincronización entre nodos del mismo nivel. El valor predeterminado de los miembros del dominio es 1. El valor predeterminado para los clientes y servidores independientes es 1.                                                                                                                                                                                                                                                                                                                                                                                                              |
|            NtpServer             |   Todo   | Entrada especifica una lista delimitada por espacios de los elementos del mismo nivel de los que un equipo obtiene las marcas de tiempo, que consta de uno o varios nombres DNS o direcciones IP por línea. Cada nombre DNS o dirección IP de la lista debe ser único. Los equipos conectados a un dominio deben sincronizarse con un origen de hora más confiable, como el reloj oficial de la hora de los EE. UU.  <ul><li>0x01 SpecialInterval </li><li>0x02 UseAsFallbackOnly</li><li>0x04 SymmetricActive: para obtener más información acerca de este modo [, consulte servidor de hora de Windows: 3,3 modos de funcionamiento](https://go.microsoft.com/fwlink/?LinkId=208012).</li><li>Cliente de 0x08</li></ul><br />No hay ningún valor predeterminado para esta entrada del registro en los miembros del dominio. El valor predeterminado en los clientes y servidores independientes es Time. Windows. com, 0x1.<br /><br />Nota: Para obtener más información sobre los servidores NTP disponibles, vea [el artículo de Microsoft Knowledge Base 262680: una lista de los servidores horarios de Protocolo simple de tiempo de redes (SNTP) que están disponibles en Internet](https://support.microsoft.com/help/262680/a-list-of-the-simple-network-time-protocol-sntp-time-servers-that-are) . |
|            ServiceDll            |   Todo   |                                                                                                                                                                                                                                                                                                                                                              W32Time mantiene la entrada. Contiene los datos reservados que usa el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los clientes y servidores independientes es%windir%\System32\W32Time.dll.                                                                                                                                                                                                                                                                                                                                                               |
|           ServiceMain            |   Todo   |                                                                                                                                                                                                                                                                                                                                                       W32Time mantiene la entrada. Contiene los datos reservados que usa el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado en los miembros del dominio es SvchostEntry_W32Time. El valor predeterminado en los clientes y servidores independientes es SvchostEntry_W32Time.  "                                                                                                                                                                                                                                                                                                                                                       |
|               Type               |   Todo   |                                                                                                                                                                                                                                  La entrada indica en qué elementos del mismo nivel se va a aceptar la sincronización:  <ul><li>**Nosync**. El servicio de hora no se sincroniza con otros orígenes.</li><li>**NTP.** El servicio de hora se sincroniza con los servidores especificados en el **NtpServer**. entrada del registro.</li><li>**NT5DS**. El servicio de hora se sincroniza desde la jerarquía de dominios.  </li><li>**AllSync**. El servicio de hora usa todos los mecanismos de sincronización disponibles.  </li></ul>El valor predeterminado en los miembros del dominio es **Nt5DS**. El valor predeterminado en los clientes y servidores independientes es **NTP**.                                                                                                                                                                                                                                   |

---
#### <a name="hklmsystemcurrentcontrolsetservicesw32timeconfig"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config

|    Entrada del registro     |          `Version`           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     AnnounceFlags     |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Entrada controla si este equipo está marcado como un servidor de hora confiable. Un equipo no está marcado como confiable a menos que también esté marcado como servidor horario.<br /> -0x00 no es un servidor horario  <br /> -0x01 servidor de tiempo siempre  <br /> -0x02 servidor horario automático  <br /> -0x04 Always Reliable Time Server  <br /> -0x08 servidor de tiempo de confianza automático  <br />El valor predeterminado de los miembros del dominio es 10. El valor predeterminado para los clientes y servidores independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|     EventLogFlags     |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          La entrada controla los eventos que registra el servicio de hora.  <br />-Salto de hora: 0x1  <br />-Cambio de origen: 0x2  <br />El valor predeterminado en los miembros del dominio es 2. El valor predeterminado en los clientes y servidores independientes es 2.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| FrequencyCorrectRate  |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    La entrada controla la velocidad a la que se corrige el reloj. Si este valor es demasiado pequeño, el reloj es inestable y se corrige. Si el valor es demasiado grande, el reloj tarda mucho tiempo en sincronizarse. El valor predeterminado en los miembros del dominio es 4. El valor predeterminado en los clientes y servidores independientes es 4.  <br /><br />Tenga en cuenta que 0 es un valor no válido para la entrada del registro FrequencyCorrectRate. En equipos con Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio de hora de Windows lo cambiará automáticamente a 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|      HoldPeriod       |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Entrada controla el período de tiempo durante el que se deshabilita la detección de picos para que el reloj local se sincronización rápidamente. Un pico es una muestra de tiempo que indica que el tiempo está fuera de un número de segundos y se recibe normalmente después de que se devuelvan los ejemplos de tiempo correctos. El valor predeterminado en los miembros del dominio es 5. El valor predeterminado en los clientes y servidores independientes es 5.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   LargePhaseOffset    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        La entrada especifica que un desplazamiento de hora mayor o igual que este valor en 10<sup>-7</sup> segundos se considera un pico. Una interrupción de la red, como una gran cantidad de tráfico, podría provocar un pico. Se omitirá un pico a menos que se mantenga durante un largo período de tiempo. El valor predeterminado en los miembros del dominio es 50 millones. El valor predeterminado en los clientes y servidores independientes es 50 millones.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     LastClockRate     |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           W32Time mantiene la entrada. Contiene los datos reservados que usa el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado en los miembros del dominio es 156250. El valor predeterminado en los clientes y servidores independientes es 156250.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| LocalClockDispersion  |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        La entrada controla la dispersión (en segundos) que debe asumir cuando el único origen de hora es el reloj CMOS integrado. El valor predeterminado en los miembros del dominio es 10. El valor predeterminado en los clientes y servidores independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| MaxAllowedPhaseOffset |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Entrada especifica el desplazamiento máximo (en segundos) que W32Time intenta ajustar el reloj del equipo con la tasa de reloj. Cuando el desplazamiento supera esta velocidad, W32Time establece el reloj del equipo directamente. El valor predeterminado de los miembros del dominio es 300. El valor predeterminado para los clientes y servidores independientes es 1.  [Consulte a continuación para obtener más información](#maxallowedphaseoffset-information).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     MaxClockRate      |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          W32Time mantiene la entrada. Contiene los datos reservados que usa el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado de los miembros del dominio es 155860. El valor predeterminado de los servidores y clientes independientes es 155860.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| MaxNegPhaseCorrection |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Entrada especifica la corrección de tiempo negativa más grande en segundos que realiza el servicio. Si el servicio determina que se necesita un cambio mayor que este, registra un evento en su lugar. Caso especial: 0xFFFFFFFF significa que siempre se realiza la corrección de tiempo. El valor predeterminado de los miembros del dominio es 0xFFFFFFFF. El valor predeterminado de los servidores y clientes independientes es 54.000 (15 horas).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|    MaxPollInterval    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Entrada especifica el intervalo más grande, en LOG2 segundos, permitido para el intervalo de sondeo del sistema. Tenga en cuenta que mientras un sistema debe sondear según el intervalo programado, un proveedor puede rechazar la generación de muestras cuando se le solicite. El valor predeterminado de los controladores de dominio es 10. El valor predeterminado de los miembros del dominio es 15. El valor predeterminado de los servidores y clientes independientes es 15.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| MaxPosPhaseCorrection |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Entrada especifica la mayor corrección de tiempo positivo en segundos que realiza el servicio. Si el servicio determina que se necesita un cambio mayor que este, registra un evento en su lugar. Caso especial: 0xFFFFFFFF significa que siempre se realiza la corrección de tiempo. El valor predeterminado de los miembros del dominio es 0xFFFFFFFF. El valor predeterminado de los servidores y clientes independientes es 54.000 (15 horas).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|     MinClockRate      |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          W32Time mantiene la entrada. Contiene los datos reservados que usa el sistema operativo Windows y los cambios que se realicen en esta configuración pueden producir resultados imprevisibles. El valor predeterminado de los miembros del dominio es 155860. El valor predeterminado de los servidores y clientes independientes es 155860.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|    MinPollInterval    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Entrada especifica el intervalo más pequeño, en LOG2 segundos, permitido para el intervalo de sondeo del sistema. Tenga en cuenta que mientras un sistema no solicita muestras con más frecuencia que esto, un proveedor puede generar ejemplos en momentos distintos del intervalo programado. El valor predeterminado de los controladores de dominio es 6. El valor predeterminado de los miembros del dominio es 10. El valor predeterminado para los clientes y servidores independientes es 10.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   PhaseCorrectRate    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           La entrada controla la velocidad a la que se corrige el error de fase. Si se especifica un valor pequeño, se corrige el error de fase rápidamente, pero es posible que el reloj se vuelve inestable. Si el valor es demasiado grande, se tarda más tiempo en corregir el error de fase. <br /><br />El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los clientes y servidores independientes es 7.<br /><br />Nota: 0 es un valor no válido para la entrada del registro PhaseCorrectRate. En equipos con Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio de hora de Windows lo cambia automáticamente a 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   PollAdjustFactor    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       La entrada controla la decisión de aumentar o disminuir el intervalo de sondeo para el sistema. Cuanto mayor sea el valor, menor será la cantidad de error que hace que se reduzca el intervalo de sondeo. El valor predeterminado en los miembros del dominio es 5. El valor predeterminado en los clientes y servidores independientes es 5.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|   SpikeWatchPeriod    |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Entrada especifica la cantidad de tiempo que un desplazamiento sospechoso debe persistir antes de que se acepte como correcto (en segundos). El valor predeterminado en los miembros del dominio es 900. El valor predeterminado en los clientes y estaciones de trabajo independientes es 900.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|  TimeJumpAuditOffset  |            Todo             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Entero sin signo que indica el umbral de auditoría de salto de hora, en segundos. Si el servicio de hora ajusta el reloj local estableciendo el reloj directamente y la corrección de tiempo es mayor que este valor, el servicio de hora registra un evento de auditoría.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|    UpdateInterval     |            Todo             | Entrada especifica el número de ciclos de reloj entre los ajustes de corrección de fase. El valor predeterminado de los controladores de dominio es 100. El valor predeterminado de los miembros del dominio es 30.000. El valor predeterminado de los servidores y clientes independientes es 360.000.  <br /><br />**NOTA**: Cero es un valor no válido para la entrada del registro UpdateInterval. En los equipos que ejecutan Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2, si el valor se establece en 0, el servicio de hora de Windows lo cambia automáticamente a 1.<br /><br />Las siguientes tres entradas del registro no forman parte de la configuración predeterminada de W32Time, pero se pueden agregar al registro para obtener una mayor capacidad de registro. La información registrada en el registro de eventos del sistema se puede modificar cambiando el valor de la opción EventLogFlags en el Editor de objetos de directiva de grupo. De forma predeterminada, el servicio de hora crea un registro en Visor de eventos cada vez que cambia a un nuevo origen de hora.<br /><br />**ADVERTENCIA**: Algunos de los valores preestablecidos que se configuran en el archivo de plantilla administrativa del sistema (System. ADM) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tiene previsto usar un GPO para configurar las opciones de hora de Windows, asegúrese de revisar [los valores preestablecidos para el servicio de hora de windows Directiva de grupo configuración es diferente de las entradas del registro del servicio de hora de Windows correspondientes en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este problema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003. |
|  UtilizeSslTimeData   | Después de la compilación 1511 de Windows 10 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             La entrada 1 indica que W32Time usará varias marcas de tiempo de SSL para inicializar un reloj que es poco preciso.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

---
Se deben agregar las siguientes entradas del registro para habilitar el registro de W32Time:  

|Entrada del registro|`Version`|Descripción|
|------------------------------------|---------------|----------------------------|
|FileLogEntries|Todo|La entrada controla la cantidad de entradas creadas en el archivo de registro de hora de Windows. El valor predeterminado es None, que no registra ninguna actividad de hora de Windows. Los valores válidos son de 0 a 300. Este valor no afecta a las entradas del registro de eventos creadas normalmente por la hora de Windows|
|FileLogName|Todo|Entrada controla la ubicación y el nombre de archivo del registro de hora de Windows. El valor predeterminado está en blanco y no debe cambiarse a menos que se cambie **FileLogEntries** . Un valor válido es una ruta de acceso completa y un nombre de archivo que la hora de Windows usará para crear el archivo de registro. Este valor no afecta a las entradas del registro de eventos creadas normalmente por la hora de Windows.  |
|FileLogSize|Todo|La entrada controla el comportamiento del registro circular de los archivos de registro de hora de Windows. Cuando se definen **FileLogEntries** y **FileLogName** , Entry define el tamaño, en bytes, para permitir que el archivo de registro alcance antes de sobrescribir las entradas de registro más antiguas con nuevas entradas. Use 1 millón o un valor mayor para esta configuración. Este valor no afecta a las entradas del registro de eventos creadas normalmente por la hora de Windows.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient

|Entrada del registro|`Version`|Descripción|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Todo|La entrada indica que se permiten combinaciones de modo no estándar en la sincronización entre nodos del mismo nivel. El valor predeterminado de los miembros del dominio es 1. El valor predeterminado para los clientes y servidores independientes es 1.|
|CompatibilityFlags|Todo|Entry especifica los siguientes valores y marcas de compatibilidad: <br /><br />- DispersionInvalid: 0x00000001  <br />- IgnoreFutureRefTimeStamp: 0x00000002  <br /> - AutodetectWin2K: 0x80000000  <br />- AutodetectWin2KStage2: 0x40000000  <br /><br />El valor predeterminado de los miembros del dominio es 0x80000000. El valor predeterminado para los clientes y servidores independientes es 0x80000000.  |
|CrossSiteSyncFlags|Todo|La entrada determina si el servicio elige asociados de sincronización fuera del dominio del equipo. Las opciones y los valores son:  <br /><br />Ninguna 0  <br />- PdcOnly: 1  <br />Todos 2  <br /><br />Este valor se omite si no se establece el valor de NT5DS. El valor predeterminado de los miembros del dominio es 2. El valor predeterminado para los clientes y servidores independientes es 2.  |
|DllName|Todo|Entry especifica la ubicación de la DLL para el proveedor de hora.  <br /><br />La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los clientes y servidores independientes es%windir%\System32\W32Time.dll.|
|Enabled|Todo|Entrada indica si el proveedor NtpClient está habilitado en el servicio de hora actual.  <br /><ul><li>Sí 1</li><li>No 0</li></ul>El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los clientes y servidores independientes es 1.|
|EventLogFlags|Todo|Entrada especifica los eventos registrados por el servicio de hora de Windows.<ul><li>0x1 cambios de disponibilidad</li><li>0X2 ejemplo de sesgo grande (esto solo es aplicable a Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2)</li></ul>El valor predeterminado en los miembros del dominio es 0x1. El valor predeterminado en los clientes y servidores independientes es 0x1.|
|InputProvider|Todo|Entrada indica si se habilita NtpClient como InputProvider, que obtiene información de hora de NtpServer. El NtpServer es un servidor horario que responde a las solicitudes de tiempo de cliente en la red, para lo que devuelve ejemplos de hora que son útiles para sincronizar el reloj local. <ul><li>Sí = 1  </li><li>No = 0 </li></ul><p>Valor predeterminado para los miembros del dominio y los clientes independientes: 1  |
|LargeSampleSkew|Todo|Entry especifica el sesgo de ejemplo grande para el registro en segundos. Para cumplir con las especificaciones de seguridad y de la Comisión de Exchange (s), debe establecerse en tres segundos. Los eventos se registrarán para esta configuración solo cuando EventLogFlags se configure explícitamente para la asimetría de ejemplo de 0X2 grande. El valor predeterminado en los miembros del dominio es 3. El valor predeterminado en los clientes y servidores independientes es 3.  |
|ResolvePeerBackOffMaxTimes|Todo|Entry especifica el número máximo de veces que se debe duplicar el intervalo de espera cuando se intenta buscar un elemento del mismo nivel que se va a sincronizar con Fail. Un valor de cero significa que el intervalo de espera siempre es el mínimo. El valor predeterminado en los miembros del dominio es 7. El valor predeterminado en los clientes y servidores independientes es 7. |
|ResolvePeerBackoffMinutes|Todo|Entry especifica el intervalo inicial que hay que esperar, en minutos, antes de intentar buscar un elemento del mismo nivel con el que sincronizar. El valor predeterminado en los miembros del dominio es 15. El valor predeterminado en los clientes y servidores independientes es 15.  |
|SpecialPollInterval|Todo|Entrada especifica el intervalo de sondeo especial en segundos para los pares manuales. Cuando se habilita la marca SpecialInterval 0x1, W32Time usa este intervalo de sondeo en lugar de un intervalo de sondeo determinando el sistema operativo. El valor predeterminado en los miembros del dominio es 3.600. El valor predeterminado en los clientes y servidores independientes es 604.800.<br/><br/>Novedad de la compilación 1702, SpecialPollInterval está incluido en los valores del registro MinPollInterval y MaxPollInterval config.|
|SpecialPollTimeRemaining|Todo|W32Time mantiene la entrada. Contiene datos reservados que usa el sistema operativo Windows. Especifica el tiempo en segundos antes de que W32Time se vuelva a sincronizar después de reiniciar el equipo. Cualquier cambio en esta configuración puede provocar resultados imprevisibles. El valor predeterminado en ambos miembros del dominio y en los clientes y servidores independientes se deja en blanco.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpServer

|Entrada del registro|`Version`|Descripción|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Todo|La entrada indica que se permiten combinaciones de modo no estándar en la sincronización entre clientes y servidores. El valor predeterminado de los miembros del dominio es 1. El valor predeterminado para los clientes y servidores independientes es 1.|
|DllName|Todo|Entry especifica la ubicación de la DLL para el proveedor de hora.<br /><br />La ubicación predeterminada de este archivo DLL en los miembros del dominio y en los clientes y servidores independientes es%windir%\System32\W32Time.dll.  |
|Enabled|Todo|La entrada indica si el proveedor NtpServer está habilitado en el servicio de hora actual. <ul><li>Sí 1</li><li>No 0</li></ul>El valor predeterminado en los miembros del dominio es 1. El valor predeterminado en los clientes y servidores independientes es 1.  |
|InputProvider|Todo|Entrada indica si se habilita NtpClient como InputProvider, que obtiene información de hora de NtpServer. El NtpServer es un servidor horario que responde a las solicitudes de tiempo de cliente en la red, para lo que devuelve ejemplos de hora que son útiles para sincronizar el reloj local. <ul><li>Sí = 1  </li><li>No = 0 </li></ul><p>Valor predeterminado para los miembros del dominio y los clientes independientes: 1  |

---

#### <a name="maxallowedphaseoffset-information"></a>Información de MaxAllowedPhaseOffset
Para que W32Time establezca el reloj del equipo gradualmente, el desplazamiento debe ser menor que el valor de **MaxAllowedPhaseOffset** y satisfacer la siguiente ecuación al mismo tiempo:  

* Windows Server 2016 y versiones posteriores:
   ```  
    |CurrentTimeOffset| / (16*PhaseCorrectRate*pollIntervalInSeconds) <= SystemClockRate / 2  
   ``` 
* Windows Server 2012 R2 y versiones anteriores:
   ```  
   |CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2  
   ``` 
El valor **CurrentTimeOffset** se mide en los tics del reloj, donde 1 ms = 10.000 TICs del reloj en un sistema Windows.  

**SystemClockRate** y **PhaseCorrectRate** también se miden en TICs de reloj. Para obtener el valor de **SystemClockRate** , puede usar el siguiente comando y convertirlo de segundos a TICs de reloj mediante la fórmula de segundos * 1000\*10000:  

```  
W32tm /query /status /verbose  
ClockRate: 0.0156000s  
```  

**SystemclockRate** es la velocidad del reloj del sistema. Con 156000 segundos como ejemplo, el valor de **SystemclockRate** sería = 0,0156000 \* 1000 \* 10000 = 156000 TICs de reloj.  

**MaxAllowedPhaseOffset** también está en segundos. Para convertirlo en TICs de reloj, multiplique **MaxAllowedPhaseOffset**\*1000\*10000.  

En los siguientes ejemplos se muestra cómo aplicar estos cálculos cuando se usa Windows Server 2012 R2 o una versión anterior.

**Ejemplo 1**: La hora difiere en 4 minutos (por ejemplo, su hora es 11:05 y el ejemplo de hora que ha recibido de un elemento del mismo nivel y considera que es correcto es 11:09).
  
```
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

|currentTimeOffset| = 4mins = 4*60\*1000\*10000 = 2400000000 ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

2400000000 <= 6000000000 = TRUE  
```

¿Y cumple la ecuación anterior? 

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 2,400,000,000 / (30000*1) <= 156000/2  

Is 80,000 <= 78,000  

NO/FALSE  
```  

Por lo tanto, W32tm establecería el reloj de nuevo inmediatamente.  

> [!NOTE]  
> En este caso, si desea volver a establecer el reloj lentamente, también tendrá que ajustar los valores de **PhaseCorrectRate** o **updateInterval** en el registro para asegurarse de que el resultado de la ecuación sea **true**.  

**Ejemplo 2**: La hora difiere en 3 minutos. 
 
```  
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

currentTimeOffset = 3mins = 3*60\*1000\*10000 = 1800000000 clock ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

1800000000 <= 6000000000 = TRUE  
```  

¿Y cumple la ecuación anterior?

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 3 mins (1,800,000,000) / (30000*1) <= 156000/2  

Is 60,000 <= 78,000  

YES/TRUE  
```  

En este caso, el reloj se devolverá lentamente.  

## <a name="windows-time-service-group-policy-settings"></a>Configuración de directiva de grupo del servicio de hora de Windows  
Puede configurar la mayoría de los parámetros de W32Time mediante el Editor de objetos de directiva de grupo. Esto incluye configurar un equipo para que sea un NTPServer o NTPClient, configurar el mecanismo de sincronización de hora y configurar un equipo para que sea un origen de hora confiable.  

> [!NOTE]  
> Directiva de grupo configuración del servicio de hora de Windows se puede configurar en los controladores de dominio de Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2 y solo se puede aplicar a equipos que ejecutan Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 y Windows Server 2008 R2.  

Puede encontrar la directiva de grupo configuración que se usa para configurar W32Time en el complemento Editor de objetos de directiva de grupo en las siguientes ubicaciones:  

-   Equipo Equipo\plantillas Templates\System\Windows hora de servicio  

    Configure las **Opciones de configuración global** aquí.  

-   Equipo Equipo\plantillas Templates\System\Windows Time Service\Time Providers  

    Configure las opciones de **cliente de Windows NTP** aquí.  

    Habilite el **cliente NTP de Windows** aquí.  

    Habilite el **servidor NTP de Windows** aquí.  

> [!WARNING]  
> Algunos de los valores preestablecidos que se configuran en el archivo de plantilla administrativa del sistema (System. ADM) para la configuración del objeto directiva de grupo (GPO) son diferentes de las entradas del Registro predeterminadas correspondientes. Si tiene previsto usar un GPO para configurar las opciones de hora de Windows, asegúrese de revisar [los valores preestablecidos para el servicio de hora de windows Directiva de grupo configuración es diferente de las entradas del registro del servicio de hora de Windows correspondientes en Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=186066). Este problema se aplica a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 y Windows Server 2003.  

En la tabla siguiente se enumeran las opciones de directiva de grupo globales asociadas con el servicio de hora de Windows y el valor preestablecido asociado a cada opción. Para obtener más información acerca de cada configuración, vea las entradas del registro correspondientes en [las entradas del registro del servicio de hora de Windows](#windows-time-service-registry-entries) anteriormente en este asunto. Las siguientes opciones de configuración están contenidas en un único GPO denominado **Opciones de configuración global**.  

**Configuración global de directiva de grupo asociada a la hora de Windows**  

|Configuración de directiva de grupo|Valor preestablecido|  
|------------------------|------------------|  
|AnnounceFlags|10|  
|EventLogFlags|2|  
|FrequencyCorrectRate|4|  
|HoldPeriod|5|  
|LargePhaseOffset|1280000|  
|LocalClockDispersion|10|  
|MaxAllowedPhaseOffset|300|  
|MaxNegPhaseCorrection|54.000 (15 horas)|  
|MaxPollInterval|15|  
|MaxPosPhaseCorrection|54.000 (15 horas)|  
|MinPollInterval|10|  
|PhaseCorrectRate|7|  
|PollAdjustFactor|5|  
|SpikeWatchPeriod|90|  
|UpdateInterval|100|  

En la tabla siguiente se enumeran las opciones disponibles para configurar el GPO de **cliente NTP de Windows** y los valores predefinidos asociados al servicio de hora de Windows. Para obtener más información acerca de cada configuración, vea las entradas del registro correspondientes en [las entradas del registro del servicio de hora de Windows](#windows-time-service-registry-entries) anteriormente en este asunto.  

**Configuración del directiva de grupo del cliente NTP asociada a la hora de Windows**  

|Configuración de directiva de grupo|Valor predeterminado|  
|------------------------|-----------------|  
|NtpServer|Time. Windows. com, 0x1|  
|Type|Opciones predeterminadas:<br /><br />-   **NTP.** Use en equipos que no estén Unidos a un dominio.<br />-   **FORZARÁ NT5DS.** Use en equipos que estén Unidos a un dominio.|  
|CrossSiteSyncFlags|2|  
|ResolvePeerBackoffMinutes|15|  
|ResolvePeerBackoffMaxTimes|7|  
|SpecialPollInterval|3600|  
|EventLogFlags|0|  

## <a name="network-ports-used-by-the-windows-time-service"></a>Puertos de red usados por el servicio de hora de Windows  
La hora de Windows sigue la especificación NTP, que requiere el uso del puerto UDP 123 para todas las comunicaciones de sincronización de tiempo. Este puerto está reservado por la hora de Windows y permanece reservado en todo momento. Cada vez que el equipo sincroniza su reloj o proporciona tiempo a otro equipo, la comunicación se realiza en el puerto UDP 123.  

> [!NOTE]  
> Si tiene un equipo con varios adaptadores de red (también denominado equipo de host múltiple), no puede habilitar de forma selectiva el servicio de hora de Windows basado en el adaptador de red.  

## <a name="related-information"></a>Información relacionada  
Los recursos siguientes contienen información adicional relevante para esta sección.  

-   RFC *1305* en la base de datos IETF RFC  

